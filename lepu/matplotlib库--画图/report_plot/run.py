import pandas as pd
import base64
from io import BytesIO
import numpy as np
import matplotlib.pyplot as plt


def _extra_shape(ax):
    points = [[1, 0], [2, 0], [2, 0], [2, 10], [2, 10],
              [4, 10], [4, 10], [4, 0], [4, 0], [5, 0]]
    line_list = [[[1, 0], [2, 0]], [[2, 0], [2, 10]],
                 [[2, 10], [4, 10]], [[4, 10], [4, 0]], [[4, 0], [5, 0]]]

    ax.scatter(*zip(*points))
    for line in line_list:
        ax.plot(*zip(*line), 'deepskyblue', linewidth=5)

def _ax_plot(ax, x, y, secs=10, lwidth=2, amplitude_ecg=10, time_ticks=1):
    # ax.set_xticklabels([])
    # ax.set_yticklabels([])
    # ax.set_xticklabels(np.arange(0, 8, time_ticks))
    for pos in ['top', 'bottom', 'right', 'left']:
        ax.spines[pos].set_color('k')
        ax.spines[pos].set_linewidth(3)

    ax.set_ylim(-amplitude_ecg, amplitude_ecg)
    ax.set_xlim(0, secs)
    # print("secs", secs, len(x), len(y))

    # ax.imshow(img, extent=[0, secs, -amplitude_ecg, amplitude_ecg])
    ax.plot(x, y, 'k-', linewidth=lwidth)
    _extra_shape(ax)


def draw_dots():
    MAX_X = 5 * 5 * 7
    MAX_Y = 5 * 14
    for i in range(-MAX_Y, MAX_Y):
        plt.plot(np.arange(0, MAX_X, 1), np.linspace(
            i, i, MAX_X), 'ro', markersize=1)


def draw_axis(MAX_X, MAX_Y):
    for i in range(0, MAX_X, 5):
        plt.vlines(i, -MAX_Y, MAX_Y, colors='indianred',
                   linestyles='-', linewidth=1)

    for i in range(0, MAX_X, 25):
        plt.vlines(i, -MAX_Y, MAX_Y, colors='indianred', linewidth=3)

    for i in range(-MAX_Y, MAX_Y, 5):
        plt.hlines(i, 0, MAX_X, colors='indianred')


def draw_sign():
    """
    text(x, y, s, fontsize=12)
    """
    plt.text(2, -4, "II", fontsize=60)

def plot_figure(data):
    x = []
    y = []
    for i, d in enumerate(data):
        x.append(i / 5 + 5)
        y.append(int(d) * 10 / 405)
    # print(len(x), len(y))

    df = pd.DataFrame({'time': x,
                    'heartrate': y})

    fig = plt.figure(num=None, figsize=(50, 20), linewidth=0,
                    dpi=45, facecolor='w', edgecolor="#04253a")
    # set ax
    ax = plt.subplot(1, 1, 1)
    _ax_plot(ax, df['time'].values, df['heartrate'].values,
            secs=25 * 7, amplitude_ecg=5 * 7)

    draw_dots()
    draw_axis(175, 35)
    draw_sign()
    return fig


def _fig_to_image_data(fig):
    # to file data
    tmpfile = BytesIO()
    fig.savefig(tmpfile, format='png', bbox_inches='tight')
    encoded = base64.b64encode(tmpfile.getvalue()).decode('utf-8')
    return encoded

va_data = ['1', '-26', '-19', '-10', '20', '31', '71', '130', '130', '130', '-94', '-128', '-161', '-97', '202', '516', '550', '-66', '-563', '-390', '-124', '-98', '-74', '-21', '25', '73', '103', '126', '159', '176', '174', '178', '164', '158', '133', '99', '65', '28', '-13', '-65', '-115', '-124', '-132', '-113', '-64', '-24', '2', '15', '18', '-2', '-26', '-69', '-112', '-140', '-158', '22', '387', '553', '246', '-376', '-562', '-224', '-98', '-100', '-45', '8', '54', '90', '121', '150', '169', '170', '175', '171', '163', '146', '116', '88', '50', '4', '-41', '-96', '-125', '-119', '-124', '-86', '-44', '-5', '11', '16', '5', '-17', '-49', '-94', '-124', '-166', '-167', '197', '511', '548', '-69', '-565', '-390', '-129', '-106', '-77', '-22', '26', '71', '102', '132', '162', '172', '170', '177', '165', '155', '131', '102', '67', '32', '-13', '-65', '-120', '-132', '-131', '-116', '-62', '-21', '4', '16', '20', '-2', '-30', '-71', '-112', '-143', '-163', '21', '383', '548', '241', '-375', '-558', '-226', '-103', '-105', '-42', '6', '48', '86', '123', '152', '177', '173', '171', '175', '164', '147', '116', '84', '47', '7', '-37', '-94', '-128', '-123', '-126', '-87', '-40', '-7', '7', '18', '6', '-22', '-54', '-96', '-124', '-160', '-161', '193', '519', '555', '-66', '-560', '-391', '-128', '-100', '-77', '-14', '31', '66', '103', '135', '159', '171', '171', '165', '160', '163', '126', '98', '66', '24', '-20', '-64', '-108', '-122', '-131', '-117', '-72', '-29', '2', '15', '18', '-5', '-34', '-73', '-116', '-149', '-167', '24', '383', '554', '247', '-375', '-558', '-223', '-102', '-104', '-35', '8', '52', '90', '119', '144', '169', '173', '171', '167', '164', '144', '112', '88', '53', '8', '-37', '-88', '-124', '-127', '-131', '-87', '-48', '-7', '12', '17', '10', '-19', '-52', '-94', '-118', '-158', '-161', '195', '516', '553', '-65', '-560', '-393', '-130', '-101', '-66', '-13', '30', '69', '103', '134', '161', '172', '174', '176', '160', '158', '130', '101', '72', '28', '-18', '-59', '-110', '-126', '-125', '-109', '-62', '-24', '4', '17', '20', '-6', '-32', '-70', '-112', '-143', '-167', '15', '384', '553', '244', '-381', '-563', '-225', '-106', '-108', '-42', '2', '46', '88', '120', '143', '167', '169', '173', '175', '163', '146', '116', '84', '46', '2', '-42', '-94', '-127', '-126', '-135', '-94', '-46', '-7', '9', '16', '6', '-15', '-46', '-94', '-125', '-164', '-167', '196', '515', '550', '-63', '-558', '-392', '-131', '-102', '-71', '-13', '26', '68', '106', '131', '159', '172', '171', '174', '162', '155', '132', '103', '65', '26', '-16', '-64', '-116', '-125', '-131', '-113', '-67', '-20', '6', '16', '19', '-7', '-30', '-73', '-111', '-138', '-166', '13', '375', '547', '246', '-374', '-561', '-223', '-100', '-105', '-44', '7', '47', '82', '117', '146', '169', '171', '179', '172', '163', '145', '115', '85', '47', '2', '-41', '-88', '-127', '-129', '-130', '-85', '-42', '-10', '8', '18', '13', '-11', '-51', '-97', '-119', '-158', '-162', '193', '516', '554', '-64', '-561', '-394', '-132', '-104', '-75', '-19', '29', '70', '102', '131', '159', '173', '175', '177', '160', '155', '132', '98', '63', '26', '-17', '-66', '-117', '-127', '-129', '-110', '-65', '-28', '1', '17', '20', '0', '-27', '-71', '-111', '-139', '-162', '18', '383', '551', '247', '-377', '-564', '-228', '-104', '-107', '-42', '9', '49', '88', '123', '145', '169', '173', '175', '169', '162', '147', '114', '81', '44', '1', '-42', '-94', '-129', '-127', '-129', '-91', '-48', '-11', '12', '17', '6', '-20', '-55', '-92', '-121', '-162', '-103', '201', '520', '555', '-59', '-559', '-391', '-123', '-98', '-75', '-17', '30', '69', '106', '136', '161', '172', '169', '176', '163', '156', '129', '100', '71', '33', '-12', '-62', '-117', '-127', '-132', '-116', '-64', '-16', '4', '16', '19', '-6', '-33', '-71', '-114', '-144', '-164', '17', '377', '550', '247', '-372', '-559', '-230', '-103', '-106', '-47', '4', '53', '89', '121', '149', '171', '175', '170', '173', '161', '146', '117', '87', '50', '3', '-39', '-89', '-124', '-127', '-129', '-86', '-44', '-4', '9', '15', '6', '-19', '-52', '-94', '-123', '-166', '-109', '192', '512', '548', '-62', '-559', '-398', '-130', '-101', '-77', '-21', '27', '68', '105', '133', '158', '174', '174', '175', '162', '160', '131', '99', '72', '30', '-17', '-64', '-115', '-125', '-132', '-111', '-63', '-26', '1', '13', '18', '-5', '-34', '-75', '-110', '-140', '-168', '16', '384', '559', '248', '-372', '-557', '-227', '-104', '-106', '-45', '7', '51', '87', '119', '143', '171', '175', '171', '165', '162', '146', '113', '83', '47', '3', '-41', '-93', '-129', '-130', '-122', '-84', '-45', '-6', '11', '15', '7', '-18', '-50', '-91', '-121', '-163', '-164', '193', '518', '555', '-61', '-557', '-396', '-128', '-100', '-78', '-15', '29', '66', '105', '133', '160', '174', '173', '176', '165', '156', '129', '99', '71', '31', '-16', '-61', '-114', '-126', '-130', '-113', '-66', '-21', '3', '15', '19', '-1', '-28', '-72', '-110', '-138', '-159', '15', '376', '551', '253', '-371', '-559', '-224', '-99', '-104', '-45', '7', '50', '89', '121', '147', '171', '167', '171', '173', '160', '146', '112', '80', '48', '3', '-40', '-94', '-131', '-126', '-130', '-91', '-47', '-8', '7', '12', '6', '-13', '-52', '-98', '-123', '-163', '-106', '194', '511', '549', '-65', '-559', '-393', '-130', '-104', '-79', '-21', '26', '64', '99', '133', '162', '171', '173', '168', '159', '160', '132', '100', '68', '25', '-20', '-62', '-112', '-125', '-131', '-115', '-69', '-26', '4', '13', '18', '-2', '-32', '-74', '-109', '-139', '-162', '21', '381', '549', '255', '-367', '-560', '-232', '-105', '-107', '-46', '10', '49', '83', '118', '143', '169', '174', '171', '164', '161', '149', '113', '82', '49', '7', '-39', '-93', '-123', '-127', '-132', '-88', '-44', '-6', '9', '18', '5', '-19', '-55', '-102', '-128', '-163', '-106', '197', '510', '547', '-55', '-555', '-399', '-135', '-103', '-71', '-16', '28', '71', '102', '127', '159', '175', '173', '175', '159', '158', '133', '95', '62', '23', '-19', '-60', '-113', '-129', '-136', '-114', '-63']
fig = plot_figure(va_data)
plt.show()


# encoded = _fig_to_image_data(fig)
# # 解码
# imagedata = base64.b64decode(encoded)#解码

# # 根据解码生成图片 
# with open('./out.jpg','wb')as fp:
#     fp.write(imagedata)

